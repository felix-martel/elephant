!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=14)}({0:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));class o extends class{constructor({sync:e=!1,key:t="elephantMain"}={sync:!1,key:"elephantMain"}){this.storage=e?chrome.storage.sync:chrome.storage.local,this.KEY=t}getCachedContent(){return new Promise((e,t)=>{this.storage.get([this.KEY],t=>{const n=t.elephantMain||{};e(n)})})}setCachedContent(e){return new Promise((t,n)=>{let o={};o[this.KEY]=e,this.storage.set(o,e=>{t()})})}}{appendBlock(e){this.getCachedContent().then(t=>{t&&t.blocks?t.blocks.push(e):t={blocks:[e],time:Date.now(),version:"2.18.0"},this.setCachedContent(t)})}}},14:function(e,t,n){"use strict";n.r(t);var o=n(0);const r=new o.a;function c(e){chrome.tabs.query({url:"chrome://newtab/"},t=>{t?Promise.all(t.map(t=>function(...e){return new Promise((t,n)=>{chrome.tabs.sendMessage(...e,e=>{t(e)})})}(t.id,{type:"append",block:e}))).then(t=>{console.log("Responses:",t),t.some(e=>Boolean(e))||r.appendBlock(e)}):r.appendBlock(e)})}function l(e,t){return t&&(e+=` <a class="external" href="${t}">[source]</a>`),{data:{text:e},type:"paragraph"}}function s(e,t){t||(t=e.replace(/https?:\/\//,""));return{data:{text:`<a href="${e}">${t}</a>`},type:"paragraph"}}chrome.contextMenus.onClicked.addListener((function(e,t){console.log(e);const n=e.pageUrl;let o;if(console.log("Clicked on",n),"add-to-elephant"===e.menuItemId){if(e.linkUrl||e.srcUrl){const t=e.linkUrl||e.srcUrl;console.log("Adding link",t,"to Elephant"),o=s(t)}else if(e.selectionText){const t=e.selectionText;console.log("Adding text",t,"to Elephant"),o=l(t,n)}else{let e;t&&t.title&&(e=t.title),console.log("Adding page",n,"to Elephant"),o=s(n,e)}c(o)}})),chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"add-to-elephant",title:"Add to Elephant",contexts:["page","link","selection","image"]})}),chrome.commands.onCommand.addListener((e,t)=>{"add-to-elephant"===e&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(!e)return;const t=e[0];console.log(t),chrome.tabs.executeScript(t.id,{code:"window.getSelection().toString()"},e=>{const n=t.url;console.log(n),console.log(e);c(e?l(e,n):s(n,t.title))})})})}});